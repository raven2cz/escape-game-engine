/* ==========================================================================
   WARP ENGINE — GAME.CSS
   Theme: Dark Sci-Fi / Bronze & Copper
   Dependencies: base/style.css, puzzles.css
   ========================================================================== */

/* --- 1. FONTS & TYPOGRAPHY --- */

@font-face {
  font-family: 'Inconsolata';
  src: url('assets/fonts/Inconsolata.woff2') format('woff2');
  font-weight: 400; font-style: normal; font-display: swap;
}

@font-face {
  font-family: 'Handelsonsix';
  src: url('assets/fonts/handelsonsix.woff2') format('woff2');
  font-weight: 400; font-style: normal; font-display: swap;
}

:root {
  /* Palette */
  --we-bg:            #0e0f12;
  --we-surface:       #14161c;
  --we-panel:         rgba(26, 29, 37, 0.95);
  --we-text:          #ece9e0;
  --we-muted:         #bdb8ac;
  --we-accent:        #b8956a; /* Bronze */
  --we-accent-glow:   rgba(184, 149, 106, 0.4);
  --we-success:       #58c59a;
  --we-danger:        #ff6b6b;
  --we-focus:         #8dc8ff; /* Sci-fi Blue for interactions */
  --we-shadow:        rgba(0, 0, 0, 0.6);

  /* Overrides for puzzles.css variables to match theme */
  --pz-text-color:    var(--we-text);

  /* FIX TOKENY: Návrat k tvému odstínu (Dark Slate), mírně vyšší opacita pro čitelnost */
  --pz-token-bg:      rgba(39, 51, 54, 0.85);
  --pz-token-border:  rgba(184, 149, 106, 0.3);

  --pz-selected-bg:   rgba(141, 200, 255, 0.1);
  --pz-selected-border: var(--we-focus);

  /* Červená pro chybu */
  --pz-wrong-bg:      rgba(220, 40, 40, 0.4);
  --pz-wrong-border:  rgba(220, 40, 40, 0.8);
}

/* GLOBAL LAYOUT & VIEWPORT FIXES */
html {
  overflow-y: auto; /* Povolit scroll pro odstrčení lišt na tabletu */
  height: 100%;
  overscroll-behavior-y: none;
}

body {
  font-family: 'Inconsolata', monospace, system-ui;
  background-color: var(--we-bg);
  color: var(--we-text);

  margin: 0;
  min-height: 100%; /* Umožní obsahu roztáhnout se */
  overflow-y: auto; /* CRITICAL pro tablety */
  -webkit-tap-highlight-color: transparent;
}

#gameRoot {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Headers */
.topbar .title,
.scene-title,
.pz-title,
.puzzle .title {
  font-family: 'Handelsonsix', sans-serif;
  letter-spacing: 0.8px;
  text-transform: uppercase;
  text-shadow: 0 2px 4px var(--we-shadow);
}

.topbar .title { font-size: 1.5em; color: var(--we-accent); }
.pz-title { font-size: 1.4em; margin-bottom: 0.5em; }

/* --- 2. UI COMPONENTS --- */

/* Buttons (Global Sci-Fi Style) */
.btn, button, .ui-button, .pz-btn {
  background: linear-gradient(180deg, #2b2f38, #232731);
  color: var(--we-text);
  border: 1px solid rgba(184, 149, 106, 0.3);
  border-radius: 8px;
  padding: 8px 16px;
  font-family: 'Inconsolata', monospace;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}

.btn:hover, button:hover, .pz-btn:hover {
  border-color: var(--we-accent);
  box-shadow: 0 0 10px var(--we-accent-glow);
  transform: translateY(-1px);
}

.btn:active { transform: translateY(1px); }

/* Inventory */
.inventory {
  background: linear-gradient(180deg, rgba(20,22,28,0.95), rgba(15,16,20,0.98));
  border-top: 1px solid var(--we-accent);
  backdrop-filter: blur(4px);
}

.inventory .item {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  transition: all 0.2s;
}

.inventory .item:hover, .inventory .item.selected {
  border-color: var(--we-focus);
  background: rgba(141, 200, 255, 0.1);
  box-shadow: 0 0 8px rgba(141, 200, 255, 0.3);
}

/* Dialogs */
.dialog-window, .dlg-panel {
  background: var(--we-panel);
  border: 1px solid var(--we-accent);
  box-shadow: 0 -10px 40px black;
  border-radius: 12px;
}

.dlg-nameplate {
  background: var(--we-bg);
  border: 1px solid var(--we-accent);
  color: var(--we-accent);
  font-family: 'Handelsonsix', sans-serif;
  text-transform: uppercase;
}

/* DIALOG CHARACTER VISUALS */
.dlg-char {
  display: flex;
  align-items: flex-end;
  justify-content: center;
  height: 100%;
  bottom: 0;

  /* Původní logika šířky - klíčové pro správné zobrazení */
  width: min(42vw, 380px);

  transition: transform 0.3s ease, filter 0.3s ease;
  z-index: 1;
}

.dlg-compact .dlg-char {
  width: min(36vw, 300px);
}

@media (max-width: 720px) {
  .dlg-char {
    width: min(46vw, 300px);
  }
}

.dlg-char-img {
  /* NÁVRAT K ORIGINÁLU: Šířka musí poslouchat rodiče */
  width: 100%;
  height: auto;

  /* FIX HLAVA: Zarážka pro výšku */
  max-height: calc(100% - 20px);

  object-fit: contain;
  filter: drop-shadow(0 10px 20px rgba(0,0,0,0.6));

  /* Skrytí alt textu */
  color: transparent;
  text-indent: -10000px;
}

.dlg-choice {
  border-radius: 20px;
  background: rgba(255,255,255,0.05);
}

/* FIX: Blur efekt pro dialog overlay (specificky pro tuto hru) */
.dlg-overlay::before {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(2px); /* Zde je požadovaný blur */
  pointer-events: auto; /* Blokuje hotspoty pod dialogem */
  z-index: 1099;
}

/* --- SPEAKER HIGHLIGHT (Pulsing Glow) --- */

/* Aktivní mluvčí - Zvýraznění */
.dlg-char.speaking {
  /* Jemný posun nahoru a zvětšení */
  transform: translateY(-6px) scale(1.05);
  z-index: 10;

  /* GLOWING EFEKT: Aplikován na filtr obrázku */
  filter: drop-shadow(0 0 25px rgba(184, 149, 106, 0.5)) brightness(1.1);
}

/* Atmosférická záře za postavou (pouze pro mluvčího) */
.dlg-char.speaking::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);

  /* Záře respektuje šířku kontejneru */
  width: 120%;
  height: 70%;

  background: radial-gradient(ellipse at center, rgba(184, 149, 106, 0.2) 0%, transparent 70%);
  z-index: -1;
  animation: speaker-pulse 2.5s infinite ease-in-out;
  pointer-events: none;
}

@keyframes speaker-pulse {
  0%, 100% { opacity: 0.3; transform: translateX(-50%) scale(0.95); }
  50% { opacity: 0.6; transform: translateX(-50%) scale(1.05); }
}

/* --- 3. PUZZLE SYSTEM (Overrides) --- */

.pz__window {
  /* Sci-fi panel look for puzzles */
  background: rgba(14, 15, 18, 0.85);
  border: 1px solid var(--we-accent);
  border-radius: 12px;
  box-shadow: 0 0 30px rgba(0,0,0,0.8);
  backdrop-filter: blur(5px);
}

/* --- 4. PUZZLE KIND: MATCH --- */

.pz-kind-match {
  --pz-token-gap: 12px;
}

/* Layout: Image + Text side-by-side */
.pz-match-column .pz-token {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 12px;
  text-align: left;
  justify-content: flex-start;
  min-height: 70px;
  padding: 8px 12px;

  /* Použijeme var(--pz-token-bg), která je teď nastavena dle tvého přání */
  background: var(--pz-token-bg);

  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: transform 0.1s, box-shadow 0.2s;
}

/* Red flash pro chybu */
.pz-match-column .pz-token.is-wrong,
.pz-match-column .pz-token.wrong {
  background: var(--pz-wrong-bg) !important;
  border-color: var(--pz-wrong-border) !important;
}

/* Selection State: Glow border only */
.pz-match-column .pz-token.is-selected,
.pz-match-column .pz-token.selected {
  background: rgba(141, 200, 255, 0.05) !important;
  border-color: var(--we-focus) !important;
  box-shadow: 0 0 0 1px var(--we-focus), 0 0 15px rgba(141, 200, 255, 0.3) !important;
  z-index: 5;
  transform: scale(1.02);
}

/* Token Images */
.pz-token-image {
  flex: 0 0 auto;
  width: auto;
  height: 64px;
  max-width: 140px;
  object-fit: contain;
  background: rgba(0,0,0,0.3);
  border-radius: 4px;
  border: 1px solid rgba(255,255,255,0.05);
}

@media (max-width: 600px) {
  .pz-match-column .pz-token {
    flex-direction: column;
    text-align: center;
    padding: 10px;
  }
  .pz-token-image {
    max-width: 100%;
    height: auto;
    max-height: 100px;
    margin-bottom: 8px;
  }
}

/* --- 5. PUZZLE KIND: CLOZE --- */

/* Dragging Mechanics */
.pz-cloze-tokens-area .pz-token,
.pz-cloze-gap .pz-token {
  touch-action: none;       /* CRITICAL for tablets */
  user-select: none;
  cursor: grab;
  background: var(--pz-token-bg);
  border: 1px solid var(--pz-token-border);
  padding: 6px 12px;
  border-radius: 6px;
  color: var(--we-text);
  font-weight: 500;
}

/* The "Ghost" element */
.pz-cloze-ghost {
  pointer-events: none !important;
  z-index: 9999;
  box-shadow: 0 15px 30px rgba(0,0,0,0.6);
  opacity: 0.95;
  transform: scale(1.1);
  border-color: var(--we-accent);
}

/* Drop Zones (Gaps) */
.pz-cloze-gap {
  background: rgba(0,0,0,0.3);

  /* FIX: Sjednocení rámečku - 1px dashed po celém obvodu v barvě tématu */
  border: 1px dashed rgba(184, 149, 106, 0.5);

  border-radius: 4px;
  min-width: 80px;
  display: inline-block;
  vertical-align: middle;
  margin: 0 4px;
  transition: all 0.2s;
}

.pz-cloze-gap.drag-over {
  background: rgba(141, 200, 255, 0.2);
  border-color: var(--we-focus);
  box-shadow: 0 0 10px rgba(141, 200, 255, 0.3);
}

.pz-cloze-gap.filled {
  border: none;
  background: transparent;
}

/* --- 6. PUZZLE KIND: GROUP & ORDER --- */

/* Buckets/Slots */
.pz-group-bucket,
.pz-order-slot {
  background: rgba(20, 22, 25, 0.8);
  border: 1px dashed rgba(184, 149, 106, 0.4);
  border-radius: 10px;
}

.pz-group-label {
  color: var(--we-accent);
  font-family: 'Handelsonsix', sans-serif;
  letter-spacing: 1px;
}

/* --- FIX: Vynucení barvy tokenů pro Group a Order puzzle --- */

/* 1. ZÁKLADNÍ STAV (Dark Slate) */
.pz-kind-group .pz-token,
.pz-kind-order .pz-token {
  background: rgba(39, 51, 54, 0.9) !important;
  border: 1px solid rgba(184, 149, 106, 0.3) !important;
  color: #ece9e0 !important;
  backdrop-filter: blur(4px);
  font-weight: 500;
  transition: background 0.2s, transform 0.1s;
}

/* 2. HOVER EFEKT */
.pz-kind-group .pz-token:hover,
.pz-kind-order .pz-token:hover {
  background: rgba(39, 51, 54, 1) !important;
  border-color: var(--we-focus) !important;
  box-shadow: 0 0 8px rgba(141, 200, 255, 0.3) !important;
  transform: translateY(-1px);
}

/* 3. CHYBOVÝ STAV (Červená) - TOTO ZAJISTÍ ZČERVENÁNÍ */
/* Musí být definováno AŽ PO základním stavu a musí mít !important */
.pz-kind-group .pz-token.wrong,
.pz-kind-group .pz-token.is-wrong,
.pz-kind-order .pz-token.wrong,
.pz-kind-order .pz-token.is-wrong {
  background: var(--pz-wrong-bg) !important;       /* Červené pozadí */
  border-color: var(--pz-wrong-border) !important; /* Červený rámeček */
  box-shadow: 0 0 15px rgba(255, 60, 60, 0.4) !important;
  animation: shake 0.4s ease-in-out; /* Ujistíme se, že animace třesení funguje */
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

/* --- 7. SCENE SPECIFIC: WARP CORE --- */

/* Overrides handled in style.css via states */

/* --- 8. ANIMATIONS & FX --- */

@keyframes titleScan {
  0%   { transform: translateX(-120%); }
  100% { transform: translateX(120%); }
}

.title-scan::after {
  content: "";
  position: absolute; inset: 0;
  background: linear-gradient(120deg, transparent 0%, rgba(184, 149, 106, 0.1) 50%, transparent 100%);
  animation: titleScan 3s ease-in-out infinite;
  pointer-events: none;
}

.toast {
  background: var(--we-panel);
  border: 1px solid var(--we-accent);
  color: var(--we-text);
  box-shadow: 0 10px 30px rgba(0,0,0,0.8);
  font-family: 'Inconsolata', monospace;
}

/* --- EPIC HIGHLIGHT GLOW (Pro hotspoty) --- */

/* Přepisujeme defaultní styl ze style.css pro tuto hru */
.hs-glow {
  /* Pozicování a vrstvy - musí být nahoře! */
  position: absolute !important;
  z-index: 9000 !important;
  pointer-events: none;

  /* Vizuál */
  background: radial-gradient(ellipse at center, rgba(88, 197, 154, 0.0) 0%, rgba(88, 197, 154, 0.3) 60%, transparent 80%);
  border: 3px solid rgba(88, 197, 154, 0.9);
  box-shadow: 0 0 40px rgba(88, 197, 154, 0.8), inset 0 0 20px rgba(88, 197, 154, 0.5);
  border-radius: 12px;

  /* Animace - začínáme viditelně! */
  opacity: 0.6;
  animation: epic-pulse 1.8s infinite ease-in-out;
}

@keyframes epic-pulse {
  0%   { transform: scale(0.95); opacity: 0.6; border-color: rgba(88, 197, 154, 0.7); }
  50%  { transform: scale(1.05); opacity: 1.0; border-color: rgba(88, 197, 154, 1.0); box-shadow: 0 0 60px rgba(88, 197, 154, 1); }
  100% { transform: scale(0.95); opacity: 0.6; border-color: rgba(88, 197, 154, 0.7); }
}
